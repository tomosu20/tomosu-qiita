---
title: AWSを実践
tags:
  - AWS
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---


# はじめに

本記事は、AWS、インフラ構築の初学者向けの記事です。
私自身も、エンジニア歴 5 年目にして、1 からインフラ構築をした経験がなく、Udemy のハンズオン講座で学習しながら得た知見を、本記事にまとめようと思います。

## そもそもインフラ構築とは？

アプリケーションが稼働できる状態を作ること。

アプリケーションが稼働するには？
アプリケーションが動く(環境)サーバーを構築して、そのアプリケーションに接続できるように、ネットワークを構成する必要がある。

## インフラ構築ができると何が嬉しい？

### 自分でサービスを作れるようになる

プログラムを書いて、良いアプリケーションを開発し、それを誰かに提供したい！となったとき、自分でできるようになる。

### 自分で開発時のテスト環境を作れるようになる

何かしら検証作業が必要な場合、本番環境で実施するわけにもいかないので、テスト環境が必要な状況ある。
そんなときに、必要な環境を自分で用意することができるようになる。

### 障害が起きても、どこに問題があるのか原因の切り分けができるようになる

「サービスにアクセスしても繋がらない」「メールが送られない」といった障害が発生した際に、アプリケーション側の問題なのか、インフラ側の問題なのか、自分で原因を切り分けて調査することができる。

## インフラを構築する基本的な流れ

### サーバーを構築(用意)する

1. どのようなサーバーが必要なのかを検討
2. 必要なサーバーを設置
3. サーバーの OS をインストールし、各種設定
4. 必要なソフトウェアをインストールし、各種設定

### 構築したサーバーをネットワークに接続する

1. ネットワークで使用する IP アドレスの範囲を決める
2. サーバーに IP アドレスを割り当てる
3. ドメイン名と IP アドレスの対応を割り当てる

# AWS（Amazon Web Service）

インフラ構築における各サービスを提供しているクラウドサービス。

https://aws.amazon.com/jp/

サービスが豊富であり、高負荷に耐えられる、信頼性の高いシステムを手間なく運用できる。
リソースを必要なときに必要な分だけ調達でき、従量課金制である。

## アカウントを作成して初期セットアップを行う

AWS アカウントの登録には、メールアドレス、クレジットカードが必要。
※クレジットカードを登録するが、特定のサービスを無料枠で利用することが可能。

### AWSアカウントを作成

上記サイトからアカウントをサインアップ。

### 請求アラートの作成

請求が発生する場合に、登録したメールアドレスへ通知する設定。

https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/monitor_estimated_charges_with_cloudwatch.html

### 作業ユーザーの作成

AWS アカウント作成時は、「ルートユーザー」にて操作を行っている状態である。
ルートユーザーは、基本的にアカウントの変更・解約・サポートプランの変更などをする際に使用するが、普段は使用しない。

通常は、作業用のユーザー(IAM ユーザー)を利用する。
IAM Identity Center にて、アカウントを管理することも可能。

https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/introduction_identity-management.html#intro-identity-users

上記のドキュメントによると、
IAM は、AWS リソースに長期的な認証情報が付与され、
IAM Identity Center には、AWS リソースに短期間の認証が付与される。

一元的にアクセス管理するには、IAM Identity Center を利用することを勧めている。

## VPCでネットワークを構築する

### 用語

VPC：Virtual Private Cloud. ユーザー専用のプライベートなクラウド環境。

- サブネット：VPC 内を細かく区切ったネットワーク
  - パブリックサブネット：インターネットに公開されたネットワーク
  - プライベートサブネット：インターネットには非公開、特定のサーバーからの通信のみを許可したネットワーク

```text
サブネット例）
Web サーバーは誰でもアクセスできるように公開したい → パブリックサブネット
DB サーバーは公開せずに、Webサーバーからアクセスできる状態にしたい → プライベートサブネット
```

ルートテーブル：VPC 内（サブネット内）の通信を振り分けるルール一覧

### VPC構築の流れ

1. VPC を作成（IP アドレス例：10.0.0.0/16）
2. サブネットを作成
   1. パブリックサブネットを作成（IP アドレス例：10.0.10.0/24）
   2. プライベートサブネットを作成（IP アドレス例：10.0.20.0/24）
3. インターネットゲートウェイを作成
   1. 作成した VPC にインターネットゲートウェイをアタッチ
4. ルートテーブルを作成
   1. サブネットの関連付けにて、パブリックサブネットを関連付ける
   2. ルートの編集から、送信先（0.0.0.0/0）をターゲット：インターネットゲートウェイに指定する

## EC2(Webサーバー)を構築する

### 用語

EC2：Elastic Compute Cloud. AWS クラウド上の仮想サーバー
インスタンス：EC2 から立てられたサーバーのこと

- EBS：Elastic Block Store
  - OS や DB などの永続性と耐久性が必要なデータを置く
  - Snapshot を取得し S3 に保存できる
- インスタンスストア
  - インスタンス専用の一時的なストレージ

基本的には EBS を利用することが多い。

### EC2構築の流れ

1. AMI：Amazon Machine Image の選択
2. インスタンスタンプ（例：m5.xlarge）の選択
3. SSH キーペアを設定
4. セキュリティグループを設定
5. ストレージを設定
